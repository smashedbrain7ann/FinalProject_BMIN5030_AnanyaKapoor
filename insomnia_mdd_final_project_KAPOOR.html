<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ananya Kapoor">
<meta name="dcterms.date" content="2025-12-12">

<title>Causal Effects of Insomnia on Major Depressive Disorder</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="insomnia_mdd_final_project_KAPOOR_files/libs/clipboard/clipboard.min.js"></script>
<script src="insomnia_mdd_final_project_KAPOOR_files/libs/quarto-html/quarto.js"></script>
<script src="insomnia_mdd_final_project_KAPOOR_files/libs/quarto-html/popper.min.js"></script>
<script src="insomnia_mdd_final_project_KAPOOR_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="insomnia_mdd_final_project_KAPOOR_files/libs/quarto-html/anchor.min.js"></script>
<link href="insomnia_mdd_final_project_KAPOOR_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="insomnia_mdd_final_project_KAPOOR_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="insomnia_mdd_final_project_KAPOOR_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="insomnia_mdd_final_project_KAPOOR_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="insomnia_mdd_final_project_KAPOOR_files/libs/bootstrap/bootstrap-10daa034703793678e481cc8cee6d76f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#scope-of-analysis-and-data-science-concepts" id="toc-scope-of-analysis-and-data-science-concepts" class="nav-link" data-scroll-target="#scope-of-analysis-and-data-science-concepts"><span class="header-section-number">2</span> Scope of analysis and data science concepts</a></li>
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources"><span class="header-section-number">3</span> Data sources</a>
  <ul class="collapse">
  <li><a href="#exposure-gwas-insomnia-uk-biobank" id="toc-exposure-gwas-insomnia-uk-biobank" class="nav-link" data-scroll-target="#exposure-gwas-insomnia-uk-biobank"><span class="header-section-number">3.1</span> Exposure GWAS: insomnia (UK Biobank)</a></li>
  <li><a href="#outcome-gwas-major-depressive-disorder-pgc" id="toc-outcome-gwas-major-depressive-disorder-pgc" class="nav-link" data-scroll-target="#outcome-gwas-major-depressive-disorder-pgc"><span class="header-section-number">3.2</span> Outcome GWAS: major depressive disorder (PGC)</a></li>
  </ul></li>
  <li><a href="#variables-and-causal-framework" id="toc-variables-and-causal-framework" class="nav-link" data-scroll-target="#variables-and-causal-framework"><span class="header-section-number">4</span> Variables and causal framework</a></li>
  <li><a href="#data-cleaning-and-quality-control" id="toc-data-cleaning-and-quality-control" class="nav-link" data-scroll-target="#data-cleaning-and-quality-control"><span class="header-section-number">5</span> Data cleaning and quality control</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods"><span class="header-section-number">6</span> Methods</a></li>
  <li><a href="#analysis-code" id="toc-analysis-code" class="nav-link" data-scroll-target="#analysis-code"><span class="header-section-number">7</span> Analysis code</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">8</span> Results</a>
  <ul class="collapse">
  <li><a href="#instrument-strength" id="toc-instrument-strength" class="nav-link" data-scroll-target="#instrument-strength"><span class="header-section-number">8.1</span> Instrument strength</a></li>
  <li><a href="#causal-effect-estimates-ivw-sensitivity-methods" id="toc-causal-effect-estimates-ivw-sensitivity-methods" class="nav-link" data-scroll-target="#causal-effect-estimates-ivw-sensitivity-methods"><span class="header-section-number">8.2</span> Causal effect estimates (IVW + sensitivity methods)</a></li>
  <li><a href="#heterogeneity-and-pleiotropy-diagnostics" id="toc-heterogeneity-and-pleiotropy-diagnostics" class="nav-link" data-scroll-target="#heterogeneity-and-pleiotropy-diagnostics"><span class="header-section-number">8.3</span> Heterogeneity and pleiotropy diagnostics</a></li>
  <li><a href="#leave-one-out-and-single-snp-results" id="toc-leave-one-out-and-single-snp-results" class="nav-link" data-scroll-target="#leave-one-out-and-single-snp-results"><span class="header-section-number">8.4</span> Leave-one-out and single-SNP results</a></li>
  </ul></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization"><span class="header-section-number">9</span> Visualization</a>
  <ul class="collapse">
  <li><a href="#scatter-plot" id="toc-scatter-plot" class="nav-link" data-scroll-target="#scatter-plot"><span class="header-section-number">9.1</span> Scatter plot</a></li>
  <li><a href="#leave-one-out-forest-plot" id="toc-leave-one-out-forest-plot" class="nav-link" data-scroll-target="#leave-one-out-forest-plot"><span class="header-section-number">9.2</span> Leave-one-out forest plot</a></li>
  <li><a href="#funnel-plot" id="toc-funnel-plot" class="nav-link" data-scroll-target="#funnel-plot"><span class="header-section-number">9.3</span> Funnel plot</a></li>
  </ul></li>
  <li><a href="#discussion-and-limitations" id="toc-discussion-and-limitations" class="nav-link" data-scroll-target="#discussion-and-limitations"><span class="header-section-number">10</span> Discussion and limitations</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">11</span> Conclusion</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Causal Effects of Insomnia on Major Depressive Disorder</h1>
<p class="subtitle lead">A Two-Sample Mendelian Randomization Analysis Using UK Biobank and PGC GWAS</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ananya Kapoor </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 12, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Global chunk options-</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">fig.width =</span> <span class="dv">7</span>, <span class="at">fig.height =</span> <span class="dv">5</span>, <span class="at">fig.retina =</span> <span class="dv">2</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Depression is a leading cause of disability worldwide and imposes a substantial public health burden. Sleep disturbances—particularly insomnia—are highly prevalent among individuals with depression and are often observed to precede depressive episodes, suggesting insomnia may be a modifiable risk factor.</p>
<p>However, observational associations between insomnia and depression are difficult to interpret causally because they can be driven by confounding (e.g., stress, socioeconomic status, medical comorbidity) and reverse causation (depression worsening sleep). To strengthen causal interpretation, this project applies two-sample Mendelian randomization (MR), which uses genetic variants associated with insomnia as instrumental variables.</p>
<p>This report tests whether genetic liability to insomnia causally increases the risk of major depressive disorder (MDD). The primary causal estimate is obtained via inverse-variance weighted (IVW) MR, and robustness is evaluated using complementary estimators and pleiotropy/outlier diagnostics.</p>
</section>
<section id="scope-of-analysis-and-data-science-concepts" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Scope of analysis and data science concepts</h1>
<p>This analysis draws on multiple data science concepts:</p>
<ol type="1">
<li><strong>API-based data acquisition</strong> of GWAS summary statistics (OpenGWAS)</li>
<li><strong>Data cleaning / QC</strong> for MR (instrument selection, LD clumping, allele harmonization, palindromic SNP handling)</li>
<li><strong>Instrument strength assessment</strong> (F-statistics)</li>
<li><strong>Causal inference</strong> using multiple MR estimators (IVW, MR-Egger, weighted median, simple median)</li>
<li><strong>Sensitivity analyses</strong> for heterogeneity and pleiotropy (Cochran’s Q, MR-Egger intercept, MR-PRESSO, leave-one-out)</li>
<li><strong>Visualization</strong> matched to MR outputs (scatter, leave-one-out forest, funnel)</li>
<li><strong>Reproducible outputs</strong> (saved tables and figures)</li>
</ol>
</section>
<section id="data-sources" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data sources</h1>
<section id="exposure-gwas-insomnia-uk-biobank" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="exposure-gwas-insomnia-uk-biobank"><span class="header-section-number">3.1</span> Exposure GWAS: insomnia (UK Biobank)</h2>
<p>Genetic instruments for insomnia are taken from UK Biobank insomnia GWAS summary statistics (OpenGWAS ID: <code>ukb-b-3957</code>). The large sample size provides strong power to identify robust genome-wide significant instruments.</p>
</section>
<section id="outcome-gwas-major-depressive-disorder-pgc" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="outcome-gwas-major-depressive-disorder-pgc"><span class="header-section-number">3.2</span> Outcome GWAS: major depressive disorder (PGC)</h2>
<p>Outcome associations are taken from the Psychiatric Genomics Consortium MDD GWAS (OpenGWAS ID: <code>ieu-a-1188</code>). Using a separate (independent) outcome GWAS is consistent with a two-sample MR design.</p>
</section>
</section>
<section id="variables-and-causal-framework" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Variables and causal framework</h1>
<p><strong>Predictor / exposure:</strong> SNP → insomnia effects ((_X), (SE_X)) <strong>Predicted / outcome:</strong> SNP → MDD effects ((_Y), (SE_Y))</p>
<p>MR estimates the causal effect of insomnia on MDD by combining SNP-specific ratios (_Y / _X) under standard MR assumptions.</p>
</section>
<section id="data-cleaning-and-quality-control" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Data cleaning and quality control</h1>
<p>Because this project uses GWAS summary statistics, “data cleaning” refers to MR-specific QC:</p>
<ol type="1">
<li><strong>Instrument selection:</strong> genome-wide significant insomnia SNPs (p &lt; 5×10⁻⁸) to satisfy instrument relevance.</li>
<li><strong>LD clumping:</strong> r² &lt; 0.001 within 10Mb to reduce correlation among instruments.</li>
<li><strong>Allele harmonization:</strong> align effect alleles between exposure and outcome.</li>
<li><strong>Palindromic SNP handling:</strong> remove ambiguous palindromic SNPs with intermediate allele frequencies (strand ambiguity).</li>
<li><strong>Instrument strength:</strong> compute per-SNP F-statistics ((F = _X<sup>2/SE_X</sup>2)) and verify instruments are strong (F &gt; 10).</li>
</ol>
<p>These steps reduce bias and improve interpretability of causal estimates.</p>
</section>
<section id="methods" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Methods</h1>
<p>The primary estimator is IVW MR, which is efficient when pleiotropy is balanced. Sensitivity methods include:</p>
<ol type="1">
<li><strong>MR-Egger</strong> (allows directional pleiotropy; lower power)</li>
<li><strong>Weighted median</strong> and <strong>simple median</strong> (robust when some instruments are invalid)</li>
<li><strong>Cochran’s Q</strong> (heterogeneity)</li>
<li><strong>MR-Egger intercept</strong> (directional pleiotropy screen)</li>
<li><strong>MR-PRESSO</strong> (outlier detection + corrected estimate + distortion test)</li>
<li><strong>Leave-one-out</strong> (influence of individual SNPs)</li>
<li><strong>Single-SNP MR</strong> (SNP-level effects; required for funnel plot)</li>
</ol>
</section>
<section id="analysis-code" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Analysis code</h1>
<blockquote class="blockquote">
<p>Before rendering, set the token locally in the Console:</p>
<p><code>Sys.setenv(OPENGWAS_JWT = "YOUR_TOKEN")</code></p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(TwoSampleMR)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ieugwasr)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(data.table)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(MRPRESSO)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.5.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Authentication check</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">nzchar</span>(<span class="fu">Sys.getenv</span>(<span class="st">"OPENGWAS_JWT"</span>))) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"OPENGWAS_JWT is not set. In Console run: Sys.setenv(OPENGWAS_JWT='YOUR_TOKEN')"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define GWAS IDs</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>exposure_id <span class="ot">&lt;-</span> <span class="st">"ukb-b-3957"</span>  <span class="co"># Insomnia (UK Biobank)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>outcome_id  <span class="ot">&lt;-</span> <span class="st">"ieu-a-1188"</span>  <span class="co"># Major Depressive Disorder (PGC)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Instruments for insomnia (GW sig + LD clumped)</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>exposure_dat <span class="ot">&lt;-</span> <span class="fu">extract_instruments</span>(</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcomes =</span> exposure_id,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">p1       =</span> <span class="fl">5e-8</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">clump    =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">r2       =</span> <span class="fl">0.001</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">kb       =</span> <span class="dv">10000</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of insomnia instruments extracted:"</span>, <span class="fu">nrow</span>(exposure_dat), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of insomnia instruments extracted: 42 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Outcome effects for the same SNPs</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>outcome_dat <span class="ot">&lt;-</span> <span class="fu">extract_outcome_data</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">snps     =</span> exposure_dat<span class="sc">$</span>SNP,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcomes =</span> outcome_id</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Extracting data for 42 SNP(s) from 1 GWAS(s)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Querying id chunk 1 of 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Querying variant chunk 1 of 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of SNPs with MDD outcome data:"</span>, <span class="fu">nrow</span>(outcome_dat), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of SNPs with MDD outcome data: 42 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Harmonise alleles (data cleaning)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">harmonise_data</span>(exposure_dat, outcome_dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Harmonising Sleeplessness / insomnia || id:ukb-b-3957 (ukb-b-3957) and Major Depressive Disorder || id:ieu-a-1188 (ieu-a-1188)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Removing the following SNPs for being palindromic with intermediate allele frequencies:
rs12049261, rs1592757, rs2297787, rs2644128, rs2803296, rs4886860, rs6561715, rs705219, rs8180817, rs931221</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of harmonised SNPs:"</span>, <span class="fu">nrow</span>(dat), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of harmonised SNPs: 42 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"SNPs retained for MR (mr_keep == TRUE):"</span>, <span class="fu">sum</span>(dat<span class="sc">$</span>mr_keep), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SNPs retained for MR (mr_keep == TRUE): 32 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Instrument strength (F-statistics)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">F_stat =</span> (beta.exposure<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (se.exposure<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>F_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(dat<span class="sc">$</span>F_stat)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>prop_weak <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat<span class="sc">$</span>F_stat <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) MR estimation (multiple estimators)</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>mr_results <span class="ot">&lt;-</span> <span class="fu">mr</span>(</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  dat,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">method_list =</span> <span class="fu">c</span>(</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mr_ivw"</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mr_ivw_fe"</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mr_egger_regression"</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mr_weighted_median"</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mr_simple_median"</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Analysing 'ukb-b-3957' on 'ieu-a-1188'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds ratios (interpretability for binary outcome)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>mr_results_or <span class="ot">&lt;-</span> mr_results <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">OR =</span> <span class="fu">exp</span>(b),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">OR_lci95 =</span> <span class="fu">exp</span>(b <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">OR_uci95 =</span> <span class="fu">exp</span>(b <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) Sensitivity analyses</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>het_res   <span class="ot">&lt;-</span> <span class="fu">mr_heterogeneity</span>(dat)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>pleio_res <span class="ot">&lt;-</span> <span class="fu">mr_pleiotropy_test</span>(dat)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>loo_res   <span class="ot">&lt;-</span> <span class="fu">mr_leaveoneout</span>(dat)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>ss        <span class="ot">&lt;-</span> <span class="fu">mr_singlesnp</span>(dat)  <span class="co"># required for funnel plot</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># MR-PRESSO</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>mrpresso_dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">SNP          =</span> dat<span class="sc">$</span>SNP,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">BetaOutcome  =</span> dat<span class="sc">$</span>beta.outcome,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">BetaExposure =</span> dat<span class="sc">$</span>beta.exposure,</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">SdOutcome    =</span> dat<span class="sc">$</span>se.outcome,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">SdExposure   =</span> dat<span class="sc">$</span>se.exposure</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>mr_presso_res <span class="ot">&lt;-</span> <span class="fu">mr_presso</span>(</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">BetaOutcome     =</span> <span class="st">"BetaOutcome"</span>,</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">BetaExposure    =</span> <span class="st">"BetaExposure"</span>,</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">SdOutcome       =</span> <span class="st">"SdOutcome"</span>,</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">SdExposure      =</span> <span class="st">"SdExposure"</span>,</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">OUTLIERtest     =</span> <span class="cn">TRUE</span>,</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">DISTORTIONtest  =</span> <span class="cn">TRUE</span>,</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">data            =</span> mrpresso_dat,</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">NbDistribution  =</span> <span class="dv">1000</span>,</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">SignifThreshold =</span> <span class="fl">0.05</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 7) Save outputs for reproducibility</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"results"</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"figures"</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(mr_results,    <span class="fu">file.path</span>(<span class="st">"results"</span>,<span class="st">"mr_results_insomnia_to_MDD.tsv"</span>), <span class="at">sep=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(mr_results_or, <span class="fu">file.path</span>(<span class="st">"results"</span>,<span class="st">"mr_results_insomnia_to_MDD_OR.tsv"</span>), <span class="at">sep=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(het_res,       <span class="fu">file.path</span>(<span class="st">"results"</span>,<span class="st">"mr_heterogeneity_insomnia_to_MDD.tsv"</span>), <span class="at">sep=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(pleio_res,     <span class="fu">file.path</span>(<span class="st">"results"</span>,<span class="st">"mr_pleiotropy_insomnia_to_MDD.tsv"</span>), <span class="at">sep=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(loo_res,       <span class="fu">file.path</span>(<span class="st">"results"</span>,<span class="st">"mr_leaveoneout_insomnia_to_MDD.tsv"</span>), <span class="at">sep=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(ss,            <span class="fu">file.path</span>(<span class="st">"results"</span>,<span class="st">"mr_singlesnp_insomnia_to_MDD.tsv"</span>), <span class="at">sep=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(mr_presso_res,<span class="fu">file.path</span>(<span class="st">"results"</span>,<span class="st">"mr_presso_insomnia_to_MDD.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="results" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Results</h1>
<section id="instrument-strength" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="instrument-strength"><span class="header-section-number">8.1</span> Instrument strength</h2>
<p>All instruments are expected to be strong if F-statistics are well above 10. Strong instruments reduce weak-instrument bias and support the MR relevance assumption.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>F_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  29.85   34.41   39.80   44.94   46.02  199.34 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Proportion of SNPs with F &lt; 10:"</span>, prop_weak, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Proportion of SNPs with F &lt; 10: 0 </code></pre>
</div>
</div>
</section>
<section id="causal-effect-estimates-ivw-sensitivity-methods" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="causal-effect-estimates-ivw-sensitivity-methods"><span class="header-section-number">8.2</span> Causal effect estimates (IVW + sensitivity methods)</h2>
<p>The primary estimate is IVW MR. Sensitivity estimators (weighted median / MR-Egger / simple median) help assess robustness under different patterns of invalid instruments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>mr_results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id.exposure id.outcome                                    outcome
1  ukb-b-3957 ieu-a-1188 Major Depressive Disorder || id:ieu-a-1188
2  ukb-b-3957 ieu-a-1188 Major Depressive Disorder || id:ieu-a-1188
3  ukb-b-3957 ieu-a-1188 Major Depressive Disorder || id:ieu-a-1188
4  ukb-b-3957 ieu-a-1188 Major Depressive Disorder || id:ieu-a-1188
5  ukb-b-3957 ieu-a-1188 Major Depressive Disorder || id:ieu-a-1188
                                   exposure
1 Sleeplessness / insomnia || id:ukb-b-3957
2 Sleeplessness / insomnia || id:ukb-b-3957
3 Sleeplessness / insomnia || id:ukb-b-3957
4 Sleeplessness / insomnia || id:ukb-b-3957
5 Sleeplessness / insomnia || id:ukb-b-3957
                                     method nsnp           b        se
1                 Inverse variance weighted   32  0.70445040 0.2071585
2 Inverse variance weighted (fixed effects)   32  0.70445040 0.1412931
3                                  MR Egger   32 -0.09926379 0.6075508
4                           Weighted median   32  0.36858486 0.2339384
5                             Simple median   32  0.94417892 0.2361434
          pval
1 6.725329e-04
2 6.172524e-07
3 8.713122e-01
4 1.151263e-01
5 6.379147e-05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mr_results_or</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id.exposure id.outcome                                    outcome
1  ukb-b-3957 ieu-a-1188 Major Depressive Disorder || id:ieu-a-1188
2  ukb-b-3957 ieu-a-1188 Major Depressive Disorder || id:ieu-a-1188
3  ukb-b-3957 ieu-a-1188 Major Depressive Disorder || id:ieu-a-1188
4  ukb-b-3957 ieu-a-1188 Major Depressive Disorder || id:ieu-a-1188
5  ukb-b-3957 ieu-a-1188 Major Depressive Disorder || id:ieu-a-1188
                                   exposure
1 Sleeplessness / insomnia || id:ukb-b-3957
2 Sleeplessness / insomnia || id:ukb-b-3957
3 Sleeplessness / insomnia || id:ukb-b-3957
4 Sleeplessness / insomnia || id:ukb-b-3957
5 Sleeplessness / insomnia || id:ukb-b-3957
                                     method nsnp           b        se
1                 Inverse variance weighted   32  0.70445040 0.2071585
2 Inverse variance weighted (fixed effects)   32  0.70445040 0.1412931
3                                  MR Egger   32 -0.09926379 0.6075508
4                           Weighted median   32  0.36858486 0.2339384
5                             Simple median   32  0.94417892 0.2361434
          pval        OR  OR_lci95 OR_uci95
1 6.725329e-04 2.0227347 1.3477274 3.035818
2 6.172524e-07 2.0227347 1.5334437 2.668149
3 8.713122e-01 0.9055038 0.2752534 2.978845
4 1.151263e-01 1.4456873 0.9139912 2.286687
5 6.379147e-05 2.5707018 1.6182378 4.083768</code></pre>
</div>
</div>
</section>
<section id="heterogeneity-and-pleiotropy-diagnostics" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="heterogeneity-and-pleiotropy-diagnostics"><span class="header-section-number">8.3</span> Heterogeneity and pleiotropy diagnostics</h2>
<p>Cochran’s Q tests for heterogeneity among SNP-specific causal estimates. The MR-Egger intercept provides a screen for directional pleiotropy. MR-PRESSO provides outlier detection and corrected estimates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>het_res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id.exposure id.outcome                                    outcome
1  ukb-b-3957 ieu-a-1188 Major Depressive Disorder || id:ieu-a-1188
2  ukb-b-3957 ieu-a-1188 Major Depressive Disorder || id:ieu-a-1188
                                   exposure                    method        Q
1 Sleeplessness / insomnia || id:ukb-b-3957                  MR Egger 62.52769
2 Sleeplessness / insomnia || id:ukb-b-3957 Inverse variance weighted 66.63854
  Q_df       Q_pval
1   30 0.0004502479
2   31 0.0002074777</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>pleio_res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id.exposure id.outcome                                    outcome
1  ukb-b-3957 ieu-a-1188 Major Depressive Disorder || id:ieu-a-1188
                                   exposure egger_intercept          se
1 Sleeplessness / insomnia || id:ukb-b-3957      0.00960808 0.006841419
       pval
1 0.1704694</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>mr_presso_res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`Main MR results`
      Exposure       MR Analysis Causal Estimate        Sd   T-stat
1 BetaExposure               Raw       0.9311825 0.2061150 4.517782
2 BetaExposure Outlier-corrected       0.8897666 0.1739723 5.114416
       P-value
1 5.209548e-05
2 8.723233e-06

$`MR-PRESSO results`
$`MR-PRESSO results`$`Global Test`
$`MR-PRESSO results`$`Global Test`$RSSobs
[1] 119.6396

$`MR-PRESSO results`$`Global Test`$Pvalue
[1] "&lt;0.001"


$`MR-PRESSO results`$`Outlier Test`
         RSSobs Pvalue
1  1.964799e-04      1
2  6.261186e-05      1
3  1.480537e-04      1
4  1.524307e-03      1
5  1.224288e-04      1
6  2.883092e-04      1
7  2.435256e-05      1
8  1.069828e-04      1
9  1.080032e-08      1
10 1.305898e-04      1
11 5.055933e-05      1
12 1.963589e-03 &lt;0.042
13 6.982807e-05      1
14 5.716766e-04  0.168
15 7.460725e-05      1
16 2.847253e-05      1
17 1.220847e-07      1
18 1.379988e-04      1
19 1.743868e-03  0.126
20 1.320419e-04      1
21 4.339989e-05      1
22 5.869938e-05      1
23 1.017232e-04      1
24 4.679529e-05      1
25 6.741660e-06      1
26 8.104967e-04  0.042
27 2.709946e-04      1
28 6.096252e-04  0.714
29 1.467165e-04      1
30 6.086697e-05      1
31 1.552646e-04      1
32 2.032619e-07      1
33 6.443017e-05      1
34 1.620667e-04      1
35 1.976352e-04      1
36 1.640215e-03   0.42
37 1.096947e-04      1
38 4.476011e-05      1
39 1.350261e-05      1
40 1.312210e-05      1
41 2.169761e-04      1
42 1.547806e-04      1

$`MR-PRESSO results`$`Distortion Test`
$`MR-PRESSO results`$`Distortion Test`$`Outliers Indices`
[1] 12 26

$`MR-PRESSO results`$`Distortion Test`$`Distortion Coefficient`
BetaExposure 
     4.65469 

$`MR-PRESSO results`$`Distortion Test`$Pvalue
[1] 0.82</code></pre>
</div>
</div>
</section>
<section id="leave-one-out-and-single-snp-results" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="leave-one-out-and-single-snp-results"><span class="header-section-number">8.4</span> Leave-one-out and single-SNP results</h2>
<p>Leave-one-out results assess whether the causal estimate is driven by a single SNP. Single-SNP MR results also support the funnel plot and SNP-level inspection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(loo_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                   exposure
1 Sleeplessness / insomnia || id:ukb-b-3957
2 Sleeplessness / insomnia || id:ukb-b-3957
3 Sleeplessness / insomnia || id:ukb-b-3957
4 Sleeplessness / insomnia || id:ukb-b-3957
5 Sleeplessness / insomnia || id:ukb-b-3957
6 Sleeplessness / insomnia || id:ukb-b-3957
                                     outcome id.exposure id.outcome samplesize
1 Major Depressive Disorder || id:ieu-a-1188  ukb-b-3957 ieu-a-1188     173005
2 Major Depressive Disorder || id:ieu-a-1188  ukb-b-3957 ieu-a-1188     173005
3 Major Depressive Disorder || id:ieu-a-1188  ukb-b-3957 ieu-a-1188     173005
4 Major Depressive Disorder || id:ieu-a-1188  ukb-b-3957 ieu-a-1188     173005
5 Major Depressive Disorder || id:ieu-a-1188  ukb-b-3957 ieu-a-1188     173005
6 Major Depressive Disorder || id:ieu-a-1188  ukb-b-3957 ieu-a-1188     173005
          SNP         b        se            p
1  rs10838708 0.6664068 0.2077721 0.0013394375
2  rs11097861 0.7193479 0.2127891 0.0007233638
3  rs11152363 0.6573001 0.2118361 0.0019165350
4 rs113851554 0.7866340 0.2229240 0.0004175910
5  rs11635495 0.7312934 0.2115961 0.0005480887
6  rs11790060 0.6459495 0.2051345 0.0016388245</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                   exposure
1 Sleeplessness / insomnia || id:ukb-b-3957
2 Sleeplessness / insomnia || id:ukb-b-3957
3 Sleeplessness / insomnia || id:ukb-b-3957
4 Sleeplessness / insomnia || id:ukb-b-3957
5 Sleeplessness / insomnia || id:ukb-b-3957
6 Sleeplessness / insomnia || id:ukb-b-3957
                                     outcome id.exposure id.outcome samplesize
1 Major Depressive Disorder || id:ieu-a-1188  ukb-b-3957 ieu-a-1188     173005
2 Major Depressive Disorder || id:ieu-a-1188  ukb-b-3957 ieu-a-1188     173005
3 Major Depressive Disorder || id:ieu-a-1188  ukb-b-3957 ieu-a-1188     173005
4 Major Depressive Disorder || id:ieu-a-1188  ukb-b-3957 ieu-a-1188     173005
5 Major Depressive Disorder || id:ieu-a-1188  ukb-b-3957 ieu-a-1188     173005
6 Major Depressive Disorder || id:ieu-a-1188  ukb-b-3957 ieu-a-1188     173005
          SNP          b        se           p
1  rs10838708  2.3852010 0.9497117 0.012021929
2  rs11097861  0.1594313 0.8662146 0.853970173
3  rs11152363  1.6817313 0.6585973 0.010664479
4 rs113851554  0.1839002 0.3826405 0.630794859
5  rs11635495 -0.2238031 0.8428087 0.790590185
6  rs11790060  2.5344276 0.8027778 0.001593618</code></pre>
</div>
</div>
</section>
</section>
<section id="visualization" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Visualization</h1>
<section id="scatter-plot" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="scatter-plot"><span class="header-section-number">9.1</span> Scatter plot</h2>
<p>The scatter plot visualizes SNP effects on insomnia (x-axis) vs MDD (y-axis) and overlays MR fitted lines. A positive slope indicates that variants increasing insomnia tend to increase depression liability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>p_scatter <span class="ot">&lt;-</span> <span class="fu">mr_scatter_plot</span>(mr_results, dat)[[<span class="dv">1</span>]]</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_scatter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insomnia_mdd_final_project_KAPOOR_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">file.path</span>(<span class="st">"figures"</span>,<span class="st">"scatter_insomnia_to_MDD.png"</span>), p_scatter, <span class="at">width=</span><span class="dv">6</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">dpi=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="leave-one-out-forest-plot" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="leave-one-out-forest-plot"><span class="header-section-number">9.2</span> Leave-one-out forest plot</h2>
<p>The forest plot summarizes leave-one-out IVW estimates. Stability across leave-one-out iterations supports robustness.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>p_forest <span class="ot">&lt;-</span> <span class="fu">mr_forest_plot</span>(loo_res)[[<span class="dv">1</span>]]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_forest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insomnia_mdd_final_project_KAPOOR_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">file.path</span>(<span class="st">"figures"</span>,<span class="st">"forest_loo_insomnia_to_MDD.png"</span>), p_forest, <span class="at">width=</span><span class="dv">6</span>, <span class="at">height=</span><span class="dv">8</span>, <span class="at">dpi=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
</div>
</section>
<section id="funnel-plot" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="funnel-plot"><span class="header-section-number">9.3</span> Funnel plot</h2>
<p>The funnel plot uses single-SNP MR results and visually screens for asymmetry, which can reflect directional pleiotropy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>p_funnel <span class="ot">&lt;-</span> <span class="fu">mr_funnel_plot</span>(ss)[[<span class="dv">1</span>]]</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_funnel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insomnia_mdd_final_project_KAPOOR_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">file.path</span>(<span class="st">"figures"</span>,<span class="st">"funnel_insomnia_to_MDD.png"</span>), p_funnel, <span class="at">width=</span><span class="dv">6</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">dpi=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="discussion-and-limitations" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Discussion and limitations</h1>
<p>This study uses multiple complementary MR estimators and sensitivity analyses to evaluate whether insomnia has a causal effect on MDD. Consistency in direction across estimators supports robustness, while heterogeneity and pleiotropy diagnostics help identify potential violations of MR assumptions.</p>
<p>Limitations include the fact that MR assumptions cannot be fully proven using summary statistics alone, and results may be most generalizable to populations represented in the underlying GWAS. Residual pleiotropy or sample overlap could still influence results, though outlier detection and multiple estimators aim to reduce these risks.</p>
</section>
<section id="conclusion" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Conclusion</h1>
<p>Using two-sample Mendelian randomization, this analysis finds evidence consistent with a causal effect of insomnia liability on MDD risk. Results are reported with effect estimates, odds ratios, and multiple sensitivity analyses to justify causal claims and quantify uncertainty. These findings support the hypothesis that improving sleep may reduce depression risk and motivate future work extending to additional sleep traits or multivariable MR approaches.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>